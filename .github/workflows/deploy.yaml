name: Build and deploy GH Pages

## ref: https://dotnet.github.io/docfx/index.html

on: 
 push:
  branches:
   - main
  paths:
    - '.github/workflows/**'
    - 'docfx/**'
    - 'README.md'
    - 'NF.Tool.ReleaseNoteMaker/**'

jobs:
  publish-docs:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      # https://github.com/actions/checkout
      - name: Checkout
        uses: actions/checkout@v5

      # https://github.com/actions/cache
      - name: Cache NuGet packages
        uses: actions/cache@v4
        with:
          path: ~/.nuget/packages
          key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}
          restore-keys: |
            ${{ runner.os }}-nuget-
      
      # https://github.com/actions/setup-dotnet
      - name: Dotnet Setup
        uses: actions/setup-dotnet@v5
        with:
          dotnet-version: 10.x

      - name: Install DocFX
        run: |
          dotnet tool update -g docfx
      - name: Build DocFX
        run: |
          docfx docfx/docfx.json
          touch ./docfx/_site/.nojekyll

      # https://github.com/peaceiris/actions-gh-pages
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v4
        if: ${{ github.ref == 'refs/heads/main' }}
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docfx/_site
